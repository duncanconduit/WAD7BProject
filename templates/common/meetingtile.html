{% load dashboard_extras %}
<div
  class="w-full bg-white dark:bg-gray-900 rounded-xl border border-gray-300 dark:border-transparent p-4 meeting"
  data-start="{{ meeting.start_time|to_timestamp }}"
  data-end="{{ meeting.end_time|to_timestamp }}"
>
  <!-- Top row: Time info & dropdown -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-2">
      <svg
        xmlns="http://www.w3.org/2000/svg" fill="none"
        viewBox="0 0 24 24" stroke-width="1.5"
        stroke="currentColor"
        class="size-6 text-brand-primary"
      >
        <path
          stroke-linecap="round" stroke-linejoin="round"
          d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"
        />
      </svg>
      <p
        class="text-base font-medium text-light_secondary_action
               dark:text-dark_secondary_action time-info"
      >
        Loading...
      </p>
    </div>
    <div class="dropdown relative">
      <button
        type="button" data-target="dropdown-default"
        class="flex items-center justify-center rounded-full px-2 py-1
               text-sm font-semibold text-black hover:text-purple-600"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg" width="12"
          height="4" fill="none"
          viewBox="0 0 12 4"
        >
          <path
            d="M1.85624 2.00085H1.81458M6.0343 2.00085H5.99263M10.2124 2.00085H10.1707"
            stroke="currentcolor" stroke-width="2.5" stroke-linecap="round"
          />
        </svg>
      </button>
    </div>
  </div>

  <!-- Middle row: Description & attendees -->
  <div class="flex mt-2 items-center justify-between">
    <h6
      class="flex-1 text-lg font-medium text-black dark:text-white
             whitespace-nowrap overflow-hidden overflow-ellipsis"
    >
      {{ meeting.description }}
    </h6>
    {% get_attendees meeting exclude_user=user include_organiser=True as attendees %}
    {% if attendees %}
      {% include 'common/avatarattending.html' with users=attendees %}
    {% endif %}
  </div>

  <!-- Bottom row: Invitation controls/status + location -->
<!-- flex-wrap ensures that if there's not enough horizontal space in the container,
     the items wrap to the next line, *independent* of screen size. -->
<div class="mt-3 flex flex-wrap items-start gap-2">

    <!-- Radio form or status message -->
    <div class="invitation_container flex-none max-w-lg style="min-width: 0;">
      {% if meeting.organiser != user and showinvite == True %}
        <form
          method="POST"
          action="{% url 'dashboard:dashboard' %}"
          class="invitation_form w-full"
          data-invite-id="{{ invite.id }}"
        >
          {% csrf_token %}
          <input type="hidden" name="invitation_id" value="{{ invite.id }}">
  
          <!-- Radio buttons with fixed max width -->
          <div class="flex w-full overflow-hidden border border-gray-200 rounded-lg">
            <!-- Accepted -->
            <label
              for="accepted_{{ invite.id }}"
              class="cursor-pointer flex-1 transition-all duration-200
                     ease-in-out hover:scale-105"
            >
              <input
                type="radio"
                name="worktype"
                id="accepted_{{ invite.id }}"
                class="sr-only peer"
                value="True"
                {% if invite.status %}checked{% endif %}
              >
              <span
                class="flex items-center justify-center w-full py-2 text-sm bg-white
                       peer-checked:bg-green-200 peer-checked:text-green-700 px-2"
              >
                <span class="relative flex items-center">
                  <span
                    class="absolute left-3 top-1/2 transform -translate-y-1/2
                           w-2 h-2 bg-green-500 rounded-full"
                  ></span>
                  <span class="ml-8">Accepted</span>
                </span>
              </span>
            </label>
  
            <!-- Maybe -->
            <label
              for="maybe_{{ invite.id }}"
              class="cursor-pointer flex-1 transition-all duration-200
                     ease-in-out hover:scale-105"
            >
              <input
                type="radio"
                name="worktype"
                id="maybe_{{ invite.id }}"
                class="sr-only peer"
                value="None"
                {% if invite.status == None %}checked{% endif %}
              >
              <span
                class="flex items-center justify-center w-full py-2 text-sm bg-white
                       peer-checked:bg-yellow-200 peer-checked:text-yellow-700 px-2"
              >
                <span class="relative flex items-center">
                  <span
                    class="absolute left-3 top-1/2 transform -translate-y-1/2
                           w-2 h-2 bg-yellow-500 rounded-full"
                  ></span>
                  <span class="ml-8">Maybe</span>
                </span>
              </span>
            </label>
  
            <!-- Declined -->
            <label
              for="declined_{{ invite.id }}"
              class="cursor-pointer flex-1 transition-all duration-200
                     ease-in-out hover:scale-105"
            >
              <input
                type="radio"
                name="worktype"
                id="declined_{{ invite.id }}"
                class="sr-only peer"
                value="False"
                {% if invite.status == False %}checked{% endif %}
              >
              <span
                class="flex items-center justify-center w-full py-2 text-sm bg-white
                       peer-checked:bg-red-200 peer-checked:text-red-700 px-2"
              >
                <span class="relative flex items-center">
                  <span
                    class="absolute left-3 top-1/2 transform -translate-y-1/2
                           w-2 h-2 bg-red-500 rounded-full"
                  ></span>
                  <span class="ml-8">Declined</span>
                </span>
              </span>
            </label>
          </div>
        </form>
      {% elif meeting.organiser != user and invite.status == True %}
        <p class="text-sm font-medium text-light_secondary_action dark:text-dark_secondary_action">
          You're Attending
        </p>
      {% else %}
        <p class="text-sm font-medium text-light_secondary_action dark:text-dark_secondary_action">
          You're Organising
        </p>
      {% endif %}
    </div>
  
    <!-- Location info gets its own flex item (flex-auto) -->
    <!-- If the container is wide, it sits on the same row; if not, it wraps below. -->
    <div class="flex-auto flex items-center gap-1">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="h-5 w-5 text-gray-500"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"
        />
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
        />
      </svg>
      <p class="text-sm text-gray-600 dark:text-gray-400 truncate">
        {{ meeting.location|default:"No location specified" }}
      </p>
    </div>
  </div>
</div>