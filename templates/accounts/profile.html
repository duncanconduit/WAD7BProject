{% extends 'base.html' %}
{% load static %}

{% block title_block %}
    &#183; profile
{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/accounts/register.css' %}" />
<script src="{% static 'js/accounts/register.js' %}"></script>
{% endblock %}

{% block body_block %}
<h1 class="text-2xl mb-5">Your Profile</h1>

<div class="mx-auto text-left align-left items-left">

<form id="profile-form" method="post" action="{% url 'accounts:profile' %}" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="relative w-1/3 md:w-1/3 lg:w-1/4 mb-4">
        <input type="text" name="first-name" id="first-name" required placeholder=" " value="{{ user.first_name }}"
            class="floating-input block w-full px-4 py-4 border border-inputborder rounded-md
                        focus:outline-none focus:ring-1 focus:ring-brand-primary focus:border-brand-primary dark:border-transparent dark:bg-darktextbox dark:text-white" />
        <label for="first-name"
            class="floating-label absolute left-4 font-light top-4 text-darkinputlabel transition-all duration-200 text-base">
            First Name
        </label>
    </div>

    <div class="relative w-1/3 md:w-1/3 lg:w-1/4 mb-4">
        <input type="text" name="first-name" id="first-name" required placeholder=" " value="{{ user.last_name }}"
            class="floating-input block w-full px-4 py-4 border border-inputborder rounded-md
                        focus:outline-none focus:ring-1 focus:ring-brand-primary focus:border-brand-primary dark:border-transparent dark:bg-darktextbox dark:text-white" />
        <label for="first-name"
            class="floating-label absolute left-4 font-light top-4 text-darkinputlabel transition-all duration-200 text-base">
            Last Name
        </label>
    </div>

     <!-- Email Display Box Aligned to the Left -->
     <div class="relative w-1/3 md:w-1/3 lg:w-1/4 mb-4">
        <div class="block px-4 py-4 border border-inputborder rounded-md
                    focus:outline-none focus:ring-1 focus:ring-brand-primary focus:border-brand-primary
                    dark:border-transparent dark:bg-darktextbox dark:text-white">
            {{ user.email }}
        </div>
        <label for="email" class="absolute left-4 font-light top-1 text-darkinputlabel transition-all duration-200 text-xs">
            Email
        </label>
    </div>

    <!-- Hidden submit button in case you want to submit the entire form -->
    <button type="submit" class="hidden" id="global-submit"></button>
</form>
</div>
<script>
    // Reusable function for setting up inline editable fields.
    function setupEditableField(fieldId) {
        const displayElement = document.getElementById(fieldId + '_display');
        const inputElement = document.getElementById(fieldId + '_input');
        const editButton = document.getElementById(fieldId + '_edit_button');
        const saveButton = document.getElementById(fieldId + '_save_button');
        const cancelButton = document.getElementById(fieldId + '_cancel_button');
        const form = document.getElementById('profile-form');

        editButton.addEventListener('click', () => {
            displayElement.classList.add('hidden');
            inputElement.classList.remove('hidden');
            saveButton.classList.remove('hidden');
            cancelButton.classList.remove('hidden');
            editButton.classList.add('hidden');
            // Optionally focus on the input field.
            inputElement.focus();
        });

        saveButton.addEventListener('click', () => {
            // Update the displayed value.
            displayElement.textContent = inputElement.value;
            displayElement.classList.remove('hidden');
            inputElement.classList.add('hidden');
            saveButton.classList.add('hidden');
            cancelButton.classList.add('hidden');
            editButton.classList.remove('hidden');
            // Submit the form to update the particular field.
            // This submits the entire form, so ensure your view handles partial updates appropriately.
            form.submit();
        });

        cancelButton.addEventListener('click', () => {
            // Reset the input value to the current display value.
            inputElement.value = displayElement.textContent;
            displayElement.classList.remove('hidden');
            inputElement.classList.add('hidden');
            saveButton.classList.add('hidden');
            cancelButton.classList.add('hidden');
            editButton.classList.remove('hidden');
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        setupEditableField('first_name');
        setupEditableField('last_name');
        setupEditableField('email');
    });
</script>
{% endblock %}